<html>
<head>
  <link rel="stylesheet" href="styles.css" type="text/css">
</head>
<body>
  <section data-main>Loading...</section>
  <!-- https://github.com/zendesk/zendesk_app_framework_sdk -->
  <script type="text/javascript" src="https://assets.zendesk.com/apps/sdk/2.0/zaf_sdk.js"></script>
  <script>
    // Initialise the Zendesk JavaScript API client
    // https://developer.zendesk.com/apps/docs/apps-v2/api_reference
    var client = ZAFClient.init();

    function renderMain(html) {
      var mainSectionEl = document.querySelector('section[data-main]');
      mainSectionEl.innerHTML = html;
    }

    function getCurrentUser() {
      return client.get('currentUser').then(function(data) {
        return data['currentUser'];
      });
    }

    function init() {
      getCurrentUser().then(function(currentUser) {
        renderMain('<p>Hi <strong>' + currentUser.name + '</strong>, please make some changes to the ticket.');

        client.on('*.changed', function(evt) {
          var html = '<p><strong>' + currentUser.name + '</strong> changed <em>' +
            evt.propertyName + '</em> to <em>' + evt.newValue + '</em>.</p>';

          renderMain(html);
        });
      });
    }

    client.on('app.registered', function() {
      client.invoke('resize', { width: '100%', height: '80px' });
      init();
    });
  </script>
</body>
</html>
